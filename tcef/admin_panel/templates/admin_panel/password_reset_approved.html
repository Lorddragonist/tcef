{% extends 'admin_panel/base.html' %}

{% block title %}Reseteo de Contraseña Aprobado - Panel de Administración{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="fas fa-check-circle me-2 text-success"></i>Reseteo de Contraseña Aprobado
            </h2>
            <a href="{% url 'admin_panel:notifications' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>Volver a Notificaciones
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-10 offset-md-1">
        <div class="card shadow-sm border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-check-circle me-2"></i>Aprobación Exitosa
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>¡Reseteo de contraseña aprobado exitosamente!</strong>
                </div>

                <div class="mb-4">
                    <h6 class="text-muted mb-3">Información del Usuario:</h6>
                    <ul class="list-unstyled ms-3">
                        <li><strong>Usuario:</strong> {{ approval.reset_request.user.username }}</li>
                        <li><strong>Email:</strong> {{ approval.reset_request.user.email }}</li>
                        <li><strong>Nombre:</strong> {{ approval.reset_request.user.get_full_name|default:"No especificado" }}</li>
                        <li><strong>Fecha de Solicitud:</strong> {{ approval.reset_request.requested_at|date:"d/m/Y H:i" }}</li>
                    </ul>
                </div>

                {% if email_sent %}
                <div class="alert alert-info">
                    <i class="fas fa-envelope me-2"></i>
                    <strong>Email enviado:</strong> Se ha enviado un email al usuario con el enlace de reseteo de contraseña.
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Error al enviar email:</strong> {{ email_error|default:"No se pudo enviar el email automáticamente." }}
                    <br><small class="text-muted">Por favor, comparte el enlace manualmente con el usuario.</small>
                </div>
                {% endif %}

                <div class="mb-4">
                    <h6 class="text-muted mb-3">
                        <i class="fas fa-link me-2"></i>Enlace de Reseteo de Contraseña
                    </h6>
                    <div class="input-group">
                        <input type="text" 
                               class="form-control" 
                               id="resetUrl" 
                               value="{{ reset_url }}" 
                               readonly>
                        <button class="btn btn-primary" 
                                type="button" 
                                onclick="copyToClipboard()"
                                title="Copiar al portapapeles">
                            <i class="fas fa-copy me-1"></i>Copiar
                        </button>
                    </div>
                    <small class="text-muted d-block mt-2">
                        <i class="fas fa-info-circle me-1"></i>
                        Este enlace es válido por 24 horas. Compártelo con el usuario para que pueda cambiar su contraseña.
                    </small>
                </div>

                <div class="alert alert-warning">
                    <i class="fas fa-clock me-2"></i>
                    <strong>Vigencia:</strong> El enlace expirará el {{ approval.reset_request.token_expires_at|date:"d/m/Y H:i" }}
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <a href="{% url 'admin_panel:notifications' %}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-1"></i>Volver a Notificaciones
                    </a>
                    <a href="{% url 'admin_panel:dashboard' %}" class="btn btn-primary">
                        <i class="fas fa-home me-1"></i>Ir al Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard() {
    const urlInput = document.getElementById('resetUrl');
    urlInput.select();
    urlInput.setSelectionRange(0, 99999); // Para dispositivos móviles
    
    try {
        document.execCommand('copy');
        
        // Mostrar feedback visual
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check me-1"></i>¡Copiado!';
        button.classList.remove('btn-primary');
        button.classList.add('btn-success');
        
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.classList.remove('btn-success');
            button.classList.add('btn-primary');
        }, 2000);
    } catch (err) {
        alert('Error al copiar. Por favor, selecciona y copia manualmente.');
    }
}
</script>
{% endblock %}

